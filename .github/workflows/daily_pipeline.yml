name: Daily Reddit ETL Pipeline

# 1. When should this run?
on:
  schedule:
    - cron: '0 6 * * *' # Run at 6:00 AM UTC every day
  workflow_dispatch:     # IMPORTANT: This gives us a "Run Now" button to test it!

# 2. What should it do?
jobs:
  run-pipeline:
    runs-on: ubuntu-latest # A fresh Linux server

    # 3. Load the keys from GitHub Secrets into the server's environment
    # 3. Load the keys from GitHub Secrets into the server's environment
    env:
      SNOWFLAKE_ACCOUNT: ${{ secrets.SNOWFLAKE_ACCOUNT }}
      SNOWFLAKE_USER: ${{ secrets.SNOWFLAKE_USER }}
      SNOWFLAKE_PASSWORD: ${{ secrets.SNOWFLAKE_PASSWORD }}
      SNOWFLAKE_WAREHOUSE: ${{ secrets.SNOWFLAKE_WAREHOUSE }}
      SNOWFLAKE_DATABASE: ${{ secrets.SNOWFLAKE_DATABASE }}
      SNOWFLAKE_SCHEMA: ${{ secrets.SNOWFLAKE_SCHEMA }}

    steps:
      - name: üì• Checkout Code
        uses: actions/checkout@v4

      - name: üêç Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: üì¶ Install Dependencies
        run: pip install -r requirements.txt

      - name: üöÄ Run Python Extraction & Load
        # UPDATE THESE NAMES if your python files are named differently!
        run: |
          python extract_reddit_rss.py
          python load_to_snowflake.py

      - name: üèóÔ∏è Run dbt Transformations
        # UPDATE 'reddit_dbt' to whatever your dbt folder is actually named!
        run: |
          cd reddit_dbt
          dbt run